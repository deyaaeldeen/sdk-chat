# Dockerfile for demo GIF recording
# Build: docker build -f demo/Dockerfile.demo -t sdk-chat-demo .
# Run:   docker run --rm -v $(pwd):/workspace sdk-chat-demo

FROM mcr.microsoft.com/dotnet/sdk:10.0

# Install VHS dependencies + Chrome for headless rendering
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl git ffmpeg ttyd fonts-liberation \
    libasound2t64 libatk-bridge2.0-0 libatk1.0-0 libcups2 libdbus-1-3 \
    libdrm2 libgbm1 libgtk-3-0 libnspr4 libnss3 libxcomposite1 \
    libxdamage1 libxfixes3 libxkbcommon0 libxrandr2 xdg-utils \
    && curl -fsSL https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb -o /tmp/chrome.deb \
    && (dpkg -i /tmp/chrome.deb || apt-get install -fy) \
    && rm -rf /tmp/chrome.deb /var/lib/apt/lists/*

# Install VHS and Copilot CLI
RUN curl -fsSL https://github.com/charmbracelet/vhs/releases/download/v0.10.0/vhs_0.10.0_Linux_x86_64.tar.gz \
    | tar -xz --strip-components=1 -C /usr/local/bin vhs_0.10.0_Linux_x86_64/vhs \
    && curl -fsSL https://gh.io/copilot-install | bash

# Clone demo SDK (pre-done so it's not in recording)
RUN git clone --depth 1 https://github.com/openai/openai-dotnet /root/openai-dotnet

ENV VHS_NO_SANDBOX=true
WORKDIR /workspace

# Entrypoint script is bind-mounted from demo/entrypoint.sh
ENTRYPOINT ["/workspace/demo/entrypoint.sh"]
